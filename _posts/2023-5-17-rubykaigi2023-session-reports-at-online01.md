---
layout: post
title: RubyKaigi2023 セッションレポート@オンライン参加(齋藤)
published_at: 2023-5-17
author: saito-site
permalink: /2023/5/17-rubykaigi2023-session-reports-at-online01
categories: [Tech, Report]
tags: [Ruby]
---

こんにちは。H2開発グループのsaito-siteです。<br>
今回は5/11(木)～5/13(土)の3日間開催された、Ruby Kaigi 2023 にオンラインで参加したのでそのレポートを書いていきます。<br>
私は今回が初めてのRuby Kaigiだったのですが、参加してみた感想としては、、難しい！！Rubyの基本的な部分は把握している前提で進んでいくので、ついていくので精一杯でした、、<br>
さて、3日間でRubyにまつわるいろいろなセッションがありましたが、その中で私は[The Resurrection of the Fast Parallel Test Runner](https://rubykaigi.org/2023/presentations/koic.html#day2){:target="_blank"}というセッションで話された、「テストの高速化」について自分なりにまとめてみます。<br>

## どうやってテストを高速化するか
rubyでなにかしらソースコードを書いた際は、同時にminitestやrspecでテストコードも書くのが常だと思います。<br>
プロジェクトが進むにつれてソースコードも多くなると、当然それに比例する形でテストコードもも増えていき、テストを回す時間も増えていきます。<br>
対応策としてはそれぞれのテストが完了するまでの時間を調べて、遅いものから早くすることなどがありますが、こういった対応はコストがかかって大変です。<br>
楽に早くするにはお金をかけてサーバーを強化して並列テストをするのが良い、という話でした。<br>
どちらも金銭的なコストがかかることには変わりがないのですが、前者の場合はテストコードをより早くできるような技術を持ったエンジニアを探す、といった時間的なコストもかかるため、サーバー強化をしてしまった方が楽だよという話だと理解しています。<br>

## rspecで高速化する際に使用するgem
minitestには並列テストの機能が備わっているのですが、rspecにはないのでgemを入れる必要があります。<br>
rspecで並列テストをする際のgemとして紹介されたのが、parallel_testsとtest_queという2つのgem。<br>
pararellel_testsの方はテストを事前に分割して回す方式になっています。<br>
ただこれには弱点があり、事前に分割してしまうので、遅いテストがあるとそれに引っ張られて全体が遅くなってしまうことがあります。(下の図の例でいうとテストの個数はA、Bどちらとも5個ですが、Bは時間のかかるテストが含まれているため、結局すべて回すのに9分かかってしまいます。)<br>
![image](/assets/images/parallel_tests.png)<br>
それに対し、test_queの方は事前分割ではなく、空いてるキューにテストを割り当てていくので無駄な時間が少ないという利点があります。<br>
![image](/assets/images/test_que.png)<br>
確かにこうして見てみるとtest_queの方がテストの高速化が見込めそう。<br>

## まとめ
記事冒頭でもお話しさせていただきましたが、私にとってはかなり難しい内容の話が多くついていくので精一杯のセッションがほとんどでした。まずは前提となるrubyの知識をもっと付けてよりセッションの内容を理解できるようにしたいなと思いました。
